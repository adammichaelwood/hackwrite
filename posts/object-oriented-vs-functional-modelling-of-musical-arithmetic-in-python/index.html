<!DOCTYPE html>
<html prefix="            og: http://ogp.me/ns# article: http://ogp.me/ns/article#     " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Object-oriented vs. Functional Modelling of Musical Arithmetic in Python | hack.write()</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="http://hackwrite.com/posts/object-oriented-vs-functional-modelling-of-musical-arithmetic-in-python/">
<!--[if lt IE 9]><script src="../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><meta name="author" content="Adam Michael Wood">
<link rel="prev" href="../emacs-for-technical-writing/" title="Emacs for Technical Writing" type="text/html">
<meta property="og:site_name" content="hack.write()">
<meta property="og:title" content="Object-oriented vs. Functional Modelling of Musical Arithmetic in Pyth">
<meta property="og:url" content="http://hackwrite.com/posts/object-oriented-vs-functional-modelling-of-musical-arithmetic-in-python/">
<meta property="og:description" content="Classical vs. Functional Modelling of Musical Arithmetic in Python¶







I'm currently building a music theory library in Python, called Ophis.






In [1]:

    
import ophis











This is an">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-11-10T11:07:06-08:00">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
         
    <header id="header"><h1 id="brand"><a href="http://hackwrite.com/" title="hack.write()" rel="home">

        <span id="blog-title">hack.write()</span>
    </a></h1>

        

        
    <nav id="menu"><ul>
<li><a href="../../archive.html">Archive</a></li>
                <li><a href="../../categories/">Tags</a></li>
                <li><a href="../../rss.xml">RSS feed</a></li>
                <li><a href="https://github.com/adammichaelwood/hackwrite">Repo</a></li>
    
    
    </ul></nav></header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Object-oriented vs. Functional Modelling of Musical Arithmetic in Python</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    Adam Michael Wood
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2017-11-10T11:07:06-08:00" itemprop="datePublished" title="2017-11-10 11:07">2017-11-10 11:07</time></a></p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/ophis-f-v-oo.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="index.ipynb" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Classical-vs.-Functional-Modelling-of-Musical-Arithmetic-in-Python">Classical vs. Functional Modelling of Musical Arithmetic in Python<a class="anchor-link" href="#Classical-vs.-Functional-Modelling-of-Musical-Arithmetic-in-Python">¶</a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I'm currently building a music theory library in Python, called <a href="https://github.com/OphisMusic/ophis">Ophis</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">ophis</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is an attempt create a utility that "understands" music theory and can manipulate music information, to be used as a base for other applications.  This would be handy for all sort of things, from music theory educational apps to AI composition.</p>
<p>In this notebook, we'll look at how I originally implemented basic musical arithmetic in Ophis, the problems with that approach, and why I am moving from a classical to a functional design.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="A-Classical-OOP-Design">A Classical OOP Design<a class="anchor-link" href="#A-Classical-OOP-Design">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>My first approach in implementing this was classically object oriented, and influenced by an essentially Platonic ontology.</p>
<p>The idea was that musical building blocks would be, as much as possible, similar to integers.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># A `Chroma` is the *idea* of a note letter name </span>
<span class="c1">#     Example: "A" or "D FLAT"</span>
<span class="c1"># 35 chromae are initialized to constants on load, </span>
<span class="c1">#   representing all 7 letter names, </span>
<span class="c1">#   with sharps, flats, double sharps, and double flats.</span>

<span class="n">ophis</span><span class="o">.</span><span class="n">wcs</span> <span class="c1"># Western Chroma Set, </span>
          <span class="c1"># the complete list of all initialized chromae</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[2]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>{BDUBFLAT,
 GDUBSHARP,
 BFLAT,
 DDUBSHARP,
 F,
 DFLAT,
 D,
 ADUBFLAT,
 AFLAT,
 G,
 CFLAT,
 C,
 FDUBFLAT,
 GDUBFLAT,
 B,
 GSHARP,
 BSHARP,
 GFLAT,
 ASHARP,
 FDUBSHARP,
 CDUBFLAT,
 DDUBFLAT,
 E,
 EDUBFLAT,
 CSHARP,
 EFLAT,
 EDUBSHARP,
 FFLAT,
 A,
 BDUBSHARP,
 CDUBSHARP,
 DSHARP,
 ADUBSHARP,
 ESHARP,
 FSHARP}</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>One of the main ideas here is that there is one and only one representation of the idea of <em>C SHARP</em> or <em>F NATURAL</em>
. Moreover, the chromae can be inspected, and know how to represent themselves.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ophis</span><span class="o">.</span><span class="n">FSHARP</span><span class="o">.</span><span class="n">unicode</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[3]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>'F♯'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ophis</span><span class="o">.</span><span class="n">FSHARP</span><span class="o">.</span><span class="n">ascii</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[4]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>'F#'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ophis</span><span class="o">.</span><span class="n">FSHARP</span><span class="o">.</span><span class="n">base</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[5]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>'F'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Chromae also carry all the logic needed for musical manipulation and mathematical representation.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">int</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">FSHARP</span><span class="p">)</span> 
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[6]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>6</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ophis</span><span class="o">.</span><span class="n">FSHARP</span><span class="o">.</span><span class="n">augment</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[7]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>G</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ophis</span><span class="o">.</span><span class="n">FSHARP</span><span class="o">.</span><span class="n">diminish</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[8]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>F</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A <code>Pitch</code> is a <code>Chroma</code> with an octave designation. Using the special <code>__call__</code> method on <code>Chroma</code>, and the <code>__repr__</code> method on <code>Pitch</code>, I was able to make their interactive representation is intuitive.</p>
<div class="highlight"><pre><span></span><span class="c1"># in Chroma class</span>

<span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">octave</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Pitch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">octave</span><span class="p">)</span>

<span class="c1"># in Pitch class:</span>

<span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chroma</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">"("</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">octave</span> <span class="o">+</span> <span class="s2">")"</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The "standard Python" way to create a pitch. </span>
<span class="n">ophis</span><span class="o">.</span><span class="n">Pitch</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">GFLAT</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[9]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>GFLAT(2)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The Ophis canonical way.</span>

<span class="n">ophis</span><span class="o">.</span><span class="n">GFLAT</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[11]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>GFLAT(2)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>Intervals</code> (without octaves) and <code>QualifiedIntervals</code> (with octaves) have a similar relationship to each other as <code>Chroma</code> and <code>Pitch</code>.</p>
<p>Rather than initializing every possible musical interval, the qualities (major, minor, perfect, augmented, diminished) are initialized and callable, to create an intuitive API.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ophis</span><span class="o">.</span><span class="n">Major</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># A Major second.</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[12]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>Major(2)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ophis</span><span class="o">.</span><span class="n">Perfect</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># A Perfect fourth, plus 2 octaves.</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[13]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>Perfect(4)^2</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Function caching is used to ensure that only one of any interval is created. (Some experimental benchmarking showed that this would matter in large scores.)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">id</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">minor</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">augmented</span><span class="p">())</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">Major</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[14]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And, of course, you can use both types of intervals to manipulate chromae and pitches.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ophis</span><span class="o">.</span><span class="n">G</span> <span class="o">+</span> <span class="n">ophis</span><span class="o">.</span><span class="n">Major</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[15]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>A</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ophis</span><span class="o">.</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">ophis</span><span class="o">.</span><span class="n">Perfect</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[16]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>E(3)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ophis</span><span class="o">.</span><span class="n">FSHARP</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">ophis</span><span class="o">.</span><span class="n">Major</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[17]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>GSHARP(3)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>All this lets you do complicated musical manipulation and representation.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">FFLAT</span> <span class="o">+</span> <span class="n">ophis</span><span class="o">.</span><span class="n">Perfect</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">diminish</span><span class="p">()</span><span class="o">.</span><span class="n">unicode</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[18]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>'B♭'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Obviously, all this is only the beginning of what is needed for a music theory library. But it <em>is</em> a beginning. The next submodule will build up <code>Duration</code> and <code>TimeSignature</code>, leading to the creation of <code>Measure</code> and eventually <code>Score</code>. My current plan is to use <code>pandas.DataFrame</code> for multi-voice scores, as that would allow cross-voice analysis in a way that multi-dimensional lists would not.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Problems-Appear">Problems Appear<a class="anchor-link" href="#Problems-Appear">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So that's great, but...</p>
<p>I can't but help wonder if some of this is overwrought.</p>
<p>A number of interrelated concerns occured to me while working on this implementation.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Logic-is-hard-to-reason-about">Logic is hard to reason about<a class="anchor-link" href="#Logic-is-hard-to-reason-about">¶</a>
</h3>
<p>The math of moving from note to note is riddled with off-by-one and modulo arithmetic problems.</p>
<ul>
<li>An interval representing no change (from a note to itself) is called a <em>unison</em>, represented with a 1. A difference of one step is called a <em>second</em>, and so on.</li>
<li>The first scale degree is 1. (Not zero indexed.)</li>
<li>We frequently think about scales as having eight notes, but in reality they only have seven. When this is zero indexed, the notes go from 0-6. This is fine for arithmetic, but when thinking as a musician it is jarring.</li>
</ul>
<p>Because of this difficulty in clear thinking on my part, I often found myself using the guess-and-check method for remembering when to add or subtract a one.</p>
<p>I wrote rigorous <a href="https://github.com/OphisMusic/ophis/tree/master/tests">tests</a> along the way to keep these errors out, so everything ends up fine in the end. However, this made for slow and sometimes demoralizing progress, and I would hate to have to go back and reason about this code after being away from it.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Incorrect-assumptions-about-logical-order">Incorrect assumptions about logical order<a class="anchor-link" href="#Incorrect-assumptions-about-logical-order">¶</a>
</h3>
<p>The first attempt to implement basic <code>Chroma</code> functionality assumed that <code>Interval</code> — the relationship between two chromae — would depend on <code>Chroma</code>. It turns out this is exactly backwards. <code>Interval</code> is logically prior to <code>Chroma</code>. There is no way to define abstract named pitches without their relationships already existing.</p>
<p>Practically speaking, discovering this simply meant I had to re-order some code. But this challenged my thinking about what the fundamental building blocks of music theory actually are.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Convoluted-logic-and-utility-data-structures">Convoluted logic and utility data structures<a class="anchor-link" href="#Convoluted-logic-and-utility-data-structures">¶</a>
</h3>
<p>Here's an example, the <code>augment</code> method from the <code>Chroma</code> class.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">augment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">magnitude</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">modifier_preference</span><span class="o">=</span><span class="s2">"sharp"</span><span class="p">):</span>
    <span class="sd">"""Return a chroma higher than the one given.</span>

<span class="sd">    Args:</span>
<span class="sd">        magnitude (:obj:`int`, :obj:`Interval`,</span>
<span class="sd">                   or obj with an ``int`` value; optional): </span>
<span class="sd">            the distance to augment by. </span>
<span class="sd">            Integer values are interpreted as half steps. </span>
<span class="sd">            Defaults to 1.</span>
<span class="sd">        modifier_preference (:obj:`str`, </span>
<span class="sd">                             ``'sharp'`` or ``'flat'``;</span>
<span class="sd">                             optional)</span>
<span class="sd">            Defaults to ``'sharp'``. </span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; C.augment()</span>
<span class="sd">        CSHARP</span>

<span class="sd">        &gt;&gt;&gt; C.augment(1, 'flat')</span>
<span class="sd">        DFLAT</span>

<span class="sd">        &gt;&gt;&gt; C.augment(minor(3))</span>
<span class="sd">        EFLAT</span>

<span class="sd">        &gt;&gt;&gt; D.augment(2)</span>
<span class="sd">        E</span>

<span class="sd">        &gt;&gt;&gt; E.augment()</span>
<span class="sd">        F</span>

<span class="sd">        &gt;&gt;&gt; E.augment(2, 'flat')</span>
<span class="sd">        GFLAT</span>
<span class="sd">    """</span>

    <span class="n">value_candidates</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">essential_set</span><span class="o">.</span><span class="n">chroma_by_value</span><span class="p">(</span>
        <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">magnitude</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">letter_candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">essential_set</span><span class="o">.</span><span class="n">chroma_by_letter</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_num</span> <span class="o">+</span> <span class="n">magnitude</span><span class="o">.</span><span class="n">distance</span>
        <span class="p">)</span>
        <span class="n">solution</span><span class="p">,</span> <span class="o">=</span> <span class="n">value_candidates</span> <span class="o">&amp;</span> <span class="n">letter_candidates</span>
        <span class="k">return</span> <span class="n">solution</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value_candidates</span><span class="o">.</span><span class="n">enharmonic_reduce</span><span class="p">(</span><span class="n">modifier_preference</span><span class="p">)</span>
</pre></div>
<p>If it isn't obvious, here's what it does:</p>
<ul>
<li>Calculate the integer value of the target <code>Chroma</code> and find the set of <code>Chroma</code> objects which have the integer value we're looking for. </li>
<li>Try:<ul>
<li>Calculate the letter name of the target <code>Chroma</code> and find the set of <code>Chroma</code> that have the name value we're looking for.</li>
<li>Find and return the union of the integer-value set and the note-name value set.</li>
</ul>
</li>
<li>Except:<ul>
<li>Return a member of the integer-value set, basing the selection on some logic (defined elsewhere) that prefers sharps to flats or flats to sharps in certain instances.</li>
</ul>
</li>
</ul>
<p>This works, but it isn't at all how a musician thinks about this operation. Moreover, it depends on the <code>essential_set</code>, the collection of all initialized chromae. (Referred to above as <code>wcs</code>, the Wesern Chroma Set.) It would be bad enough if this was <em>just</em> used to keep the pool of initialized chromae, so that methods returning <em>C Sharp</em> always returned the same <em>C Sharp</em>. But it doesn't just do that. An inordinate amount of musical knowledge and logic crept into the <code>ChromaSet</code> class that defines the <code>essential_set</code>. While I'm positive that some of this is due to bad <em>coding</em> on my part, I think the bulk of it is due to bad <em>conceptualization</em>.</p>
<p>The final problem with this is that it is non-obvious. This code is hard to read and reason about, because it isn't clear what is actually happening.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Fragile-Primitives">Fragile Primitives<a class="anchor-link" href="#Fragile-Primitives">¶</a>
</h3>
<p>Python doesn't <em>really</em> allow you to protect object attributes or module-level constants. There are some things you can do to ensure object attributes aren't reassigned accidentally (and I've done them), but (as far as I can tell) module-level constants cannot be protected.</p>
<p>This is a problem, since the fundamental building blocks of music theory in the current implementation are initialized as constants. The object representing <em>C Sharp</em> is created and assigned to the name <code>CSHARP</code>. If that name gets reassigned, <em>you are basically hosed</em>. This could lead to hard-to-trace errors and frustrating interactive sessions.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Poor-isomorphism-to-numbers">Poor isomorphism to numbers<a class="anchor-link" href="#Poor-isomorphism-to-numbers">¶</a>
</h3>
<p>One of the design goals of Ophis is to be able to treat musical concepts as numbers. That's why the arithmetic operators are implemented and everything has an integer value. I wanted it to be easy for math utilities to operate on pitches and intervals. This would enable things like advanced theoretical analysis  and machine learning.</p>
<p>But, they <em>aren't</em> numbers. They just aren't.</p>
<p>You can't (meaningfully) have a Chroma with a float, decimal, or fractional value. This means that <a href="https://en.wikipedia.org/wiki/Microtonal_music">microtones</a> are not presently accounted for and will require an extension, the logic of which I can only guess at.</p>
<p>You also can't meaningfully multiply or divide values. Offhand, I'm not sure why you would want to do so, but I can imagine approaches to musical analysis where it would be needed.</p>
<p>Further, even with supported integer-based operations, using any standard math tool requires notes from a score to be converted into numbers, manipulated or analyzed, and converted back. There's no direct access to Ophis "primitives" in Numpy, SciKitLearn, or anything else.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These problems piled up over time as I implemented the basic logic and worked out the implications. Technical debt accumulates through a process of small compromises and justifications. By the time I became aware of the scope of the problem, I had two thoughts:</p>
<ul>
<li>Re-architecting everything would take too long to be worthwhile. I would probably get disheartened and give up.</li>
<li>I can refactor the internals in the future to make things a bit clearer and cleaner. In the meantime, good documentation would make the code maintainable.</li>
</ul>
<p>So, my plan was to just keep moving. But then, thinking about the isomorphism problem, I realized another poorly-mapped isomorphism.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Poor-isomorphism-between-Chroma-and-Intervals">Poor isomorphism between Chroma and Intervals<a class="anchor-link" href="#Poor-isomorphism-between-Chroma-and-Intervals">¶</a>
</h3>
<p>Or really, no explicit isomorphism at all. And this is a problem because these are really <em>the same thing</em>.</p>
<p>I had implemented the <code>Interval</code> class, and written all the logic for how intervals are inverted, augmented, and diminished. This requires understanding of the interplay between interval distances (third, fourth, sixth) and their qualities (Major, minor, Perfect), and how many half-steps each are. And of course there's that zero-indexing stuff to think about (second = 1, third = 2).</p>
<p>Then I implemented the <code>Chroma</code> class, and wrote almost the same logic (but just a bit different) for how pitches are augmented and diminished (pitches aren't inverted). This requires an understanding of the interplay between note letter names (C, D, E), how those letter names map to a zero-indexed numerical representation (C = 0, D = 1, E = 2), and how modifiers like <em>sharp</em> and <em>flat</em> affect the total number of halfsteps from C (the origin point in modern music theory).</p>
<p>But these are, as I said, <em>exactly the same thing</em>.</p>
<p>Every note can be represented as an interval from C. And not only can it be represented that way, but that is exactly how it was already defined. There is no other reasonable way to (numerically) define notes.</p>
<p>Here's an example in case this isn't clear:</p>
<ul>
<li>
<em>E Natural</em> is a Major Third away from <em>C</em>. </li>
<li>In our zero-indexed representation intervals, a Third is <code>2</code>.</li>
<li>A Major Third is <code>4</code> half-steps. </li>
</ul>
<p>Those two numbers, <code>(2, 4)</code>, are an integral part of the definition of <em>E Natural</em>; without them, you can't do any of the manipulation that makes the <code>Chroma</code> meaningful.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">Major</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">Major</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">base_num</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">E</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>2 4
2 4
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Obviously, this holds for every other <code>Chroma</code> as well.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">Perfect</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">Perfect</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">base_num</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">G</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>4 7
4 7
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">Augmented</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">Augmented</span><span class="p">(</span><span class="mi">6</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">ASHARP</span><span class="o">.</span><span class="n">base_num</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">ASHARP</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>5 10
5 10
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Further, it turns out that these two numbers are the <em>only</em> things you need to know in order to do any standard musical manipulation you might want to do.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">g_or_p5</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span> <span class="c1"># Tuple representing G or a Perfect Fifth</span>
<span class="n">e_or_maj3</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="c1"># Tuple representing E or a Major Third</span>

<span class="c1"># Add tuples element wise.</span>
<span class="n">sum_of_tuples</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">g_or_p5</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">e_or_maj3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
    <span class="n">g_or_p5</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">e_or_maj3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">sum_of_tuples</span> <span class="c1"># (6,11)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[22]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>(6, 11)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">g_augmented_by_maj3</span> <span class="o">=</span> <span class="n">ophis</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">augment</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">Major</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="n">e_augmented_by_p5</span> <span class="o">=</span> <span class="n">ophis</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">augment</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">Perfect</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">g_augmented_by_maj3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">e_augmented_by_p5</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>B
B
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">base_num</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">B</span><span class="p">))</span> 
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>6 11
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">ophis</span><span class="o">.</span><span class="n">Perfect</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">ophis</span><span class="o">.</span><span class="n">Major</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">z</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[25]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>Major(7)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">z</span><span class="p">))</span> 
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>6 11
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So any chroma and any interval can be represented by a two-tuple, while manipulations originally implemented as methods in different classes can be a unified set of pure functions that accept tuples as arguments.</p>
<p>Great.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>But two-tuples don't provide all the additional information you need to notate pitches or otherwise make them understandable <em>as music</em>.</p>
<p>So we need some "translation" functions. This still involves a lot of "magic number" coding, but hopefully it can be condensed into a small set of mappings that are easy to reason about.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">bidict</span> <span class="c1"># efficient two-way indexing of dicts</span>

<span class="n">primary_map</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># half steps, scale degree / interval number, </span>
    <span class="c1"># interval name, letter name, Perfect? </span>
    <span class="c1">#                             (False=Major) </span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="s2">"unison"</span><span class="p">,</span>  <span class="s2">"C"</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>  <span class="c1">#0</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="s2">"second"</span><span class="p">,</span>  <span class="s2">"D"</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="c1">#1</span>
    <span class="p">(</span><span class="mi">4</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="s2">"third"</span><span class="p">,</span>   <span class="s2">"E"</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="c1">#2</span>
    <span class="p">(</span><span class="mi">5</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="s2">"fourth"</span><span class="p">,</span>  <span class="s2">"F"</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>  <span class="c1">#3</span>
    <span class="p">(</span><span class="mi">7</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="s2">"fifth"</span><span class="p">,</span>   <span class="s2">"G"</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>  <span class="c1">#4</span>
    <span class="p">(</span><span class="mi">9</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="s2">"sixth"</span><span class="p">,</span>   <span class="s2">"A"</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="c1">#5</span>
    <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">"seventh"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>  <span class="c1">#6</span>
<span class="p">]</span>

<span class="c1"># Split primary map into bidicts for each value.</span>
<span class="c1">#     For faster, more sensible referencing.</span>
<span class="c1">#     This feels wrong and I need a better way.</span>
<span class="c1">#     Maybe something with named tuple...</span>

<span class="n">hs_map</span> <span class="o">=</span> <span class="n">bidict</span><span class="o">.</span><span class="n">bidict</span><span class="p">(</span>
    <span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">primary_map</span><span class="p">)}</span>
<span class="p">)</span>
<span class="n">interval_map</span> <span class="o">=</span> <span class="n">bidict</span><span class="o">.</span><span class="n">bidict</span><span class="p">(</span>
    <span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">primary_map</span><span class="p">)}</span>
<span class="p">)</span>
<span class="n">interval_name_map</span> <span class="o">=</span> <span class="n">bidict</span><span class="o">.</span><span class="n">bidict</span><span class="p">(</span>
    <span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">primary_map</span><span class="p">)}</span>
<span class="p">)</span>
<span class="n">name_map</span> <span class="o">=</span> <span class="n">bidict</span><span class="o">.</span><span class="n">bidict</span><span class="p">(</span>
    <span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">primary_map</span><span class="p">)}</span>
<span class="p">)</span>
<span class="n">quality_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">x</span><span class="p">:</span><span class="n">item</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">primary_map</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># How to translate between </span>
<span class="c1"># diatonic intervals and modified intervals.</span>
<span class="n">interval_quality_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="kc">True</span><span class="p">:</span> <span class="n">bidict</span><span class="o">.</span><span class="n">bidict</span><span class="p">({</span> <span class="c1"># Diatonic is Perfect</span>
        <span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="s1">'double diminished'</span><span class="p">,</span> 
        <span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="s1">'diminished'</span><span class="p">,</span> 
         <span class="mi">0</span> <span class="p">:</span> <span class="s1">'Perfect'</span><span class="p">,</span>
         <span class="mi">1</span> <span class="p">:</span> <span class="s1">'Augmented'</span><span class="p">,</span> 
         <span class="mi">2</span> <span class="p">:</span> <span class="s1">'Double Augmented'</span>
    <span class="p">}),</span>
    <span class="kc">False</span><span class="p">:</span> <span class="n">bidict</span><span class="o">.</span><span class="n">bidict</span><span class="p">({</span> <span class="c1"># Diatonic is Major</span>
        <span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="s1">'diminished'</span><span class="p">,</span> 
        <span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="s1">'minor'</span><span class="p">,</span> 
         <span class="mi">0</span> <span class="p">:</span> <span class="s1">'Major'</span><span class="p">,</span> 
         <span class="mi">1</span> <span class="p">:</span> <span class="s1">'Augmented'</span><span class="p">,</span> 
         <span class="mi">2</span> <span class="p">:</span> <span class="s1">'Double Augmented'</span>
    <span class="p">})</span>
<span class="p">}</span>

<span class="n">modifiers</span> <span class="o">=</span> <span class="n">bidict</span><span class="o">.</span><span class="n">bidict</span><span class="p">({</span>
    <span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="s1">'doubleflat'</span><span class="p">,</span>
    <span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="s1">'flat'</span><span class="p">,</span>
     <span class="mi">0</span> <span class="p">:</span> <span class="s1">'natural'</span><span class="p">,</span>
     <span class="mi">1</span> <span class="p">:</span> <span class="s1">'sharp'</span><span class="p">,</span> 
     <span class="mi">2</span> <span class="p">:</span> <span class="s1">'doublesharp'</span>
<span class="p">})</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>

<span class="c1"># Single Dispatch:</span>
<span class="c1">#     two functions with the same signature.</span>
<span class="c1">#</span>
<span class="c1">#     The type of the first argument determines </span>
<span class="c1">#     which function is executed.</span>
<span class="c1">#     This way, if a tuple is passed in, </span>
<span class="c1">#         a string is returned,</span>
<span class="c1">#     and if a string is passed in, </span>
<span class="c1">#         a tuple is returned.</span>

<span class="nd">@functools</span><span class="o">.</span><span class="n">singledispatch</span>
<span class="k">def</span> <span class="nf">chroma</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="nd">@chroma</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">tuple</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">xy</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">xy</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">modifier</span> <span class="o">=</span> <span class="n">modifiers</span><span class="p">[</span><span class="n">y</span> <span class="o">-</span> <span class="n">hs_map</span><span class="p">[</span><span class="n">x</span><span class="p">]]</span>
    <span class="k">return</span> <span class="s2">" "</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="n">modifier</span><span class="p">])</span>

<span class="nd">@chroma</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">letter</span><span class="p">,</span> <span class="n">modifier</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">name_map</span><span class="o">.</span><span class="n">inv</span><span class="p">[</span><span class="n">letter</span><span class="p">]</span>
    <span class="n">mod_diff</span> <span class="o">=</span> <span class="n">modifiers</span><span class="o">.</span><span class="n">inv</span><span class="p">[</span><span class="n">modifier</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">hs_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="n">mod_diff</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span>

<span class="nd">@functools</span><span class="o">.</span><span class="n">singledispatch</span>
<span class="k">def</span> <span class="nf">interval</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="nd">@interval</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">tuple</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">xy</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">xy</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">interval_name_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">q_mod</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">hs_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">interval_quality_map</span><span class="p">[</span><span class="n">quality_map</span><span class="p">[</span><span class="n">y</span><span class="p">]][</span><span class="n">q_mod</span><span class="p">]</span>
    <span class="k">return</span> <span class="s2">" "</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">q</span><span class="p">,</span> <span class="n">name</span><span class="p">])</span>

<span class="nd">@interval</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span> <span class="c1"># quality, number</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">is_perfect</span> <span class="o">=</span> <span class="n">quality_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">q_mod</span> <span class="o">=</span> <span class="n">interval_quality_map</span><span class="p">[</span><span class="n">is_perfect</span><span class="p">]</span><span class="o">.</span><span class="n">inv</span><span class="p">[</span><span class="n">q</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">hs_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="n">q_mod</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
    
<span class="k">def</span> <span class="nf">augment</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">sum</span><span class="p">,</span><span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)))</span>

<span class="k">def</span> <span class="nf">diminish</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">chroma</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[29]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>'C natural'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [30]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">interval</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[30]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>'diminished third'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [31]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">chroma</span><span class="p">(</span><span class="s1">'D'</span><span class="p">,</span> <span class="s1">'sharp'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[31]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>(1, 3)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [32]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">interval</span><span class="p">(</span><span class="s1">'Major'</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[32]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>(2, 4)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [33]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">chroma</span><span class="p">(</span><span class="n">augment</span><span class="p">(</span><span class="n">chroma</span><span class="p">(</span><span class="s1">'C'</span><span class="p">,</span> <span class="s1">'sharp'</span><span class="p">),</span> <span class="n">interval</span><span class="p">(</span><span class="s1">'minor'</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[33]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>'E natural'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [34]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> chroma(
    <span class="n">augment</span><span class="p">(</span><span class="n">chroma</span><span class="p">(</span><span class="s1">'C'</span><span class="p">,</span> <span class="s1">'sharp'</span><span class="p">),</span> <span class="n">interval</span><span class="p">(</span><span class="s1">'minor'</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>22.3 µs ± 1.4 µs per loop (mean ± std. dev. of 7 runs, 100000 loops each)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [35]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ophis</span><span class="o">.</span><span class="n">CSHARP</span><span class="o">.</span><span class="n">augment</span><span class="p">(</span><span class="n">ophis</span><span class="o">.</span><span class="n">minor</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[35]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>E</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [36]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">timeit</span> ophis.CSHARP.augment(ophis.minor(3))
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>101 µs ± 3.95 µs per loop (mean ± std. dev. of 7 runs, 10000 loops each)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A functional approach:</p>
<ul>
<li>simplifies the math and logic</li>
<li>preserves important isomorphisms</li>
<li>requires much less code</li>
<li>executes much faster</li>
</ul>
<p>The only downside is that the API for interactive use is a little less elegant, but not so much as to be a problem.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Where-to-Go-From-Here">Where to Go From Here<a class="anchor-link" href="#Where-to-Go-From-Here">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The quick functional implementation demonstrated here doesn't include all the things that the OO approach currently has.</p>
<p>Foremost, this version needs to include modulo arithmetic.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [37]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">augment</span><span class="p">((</span><span class="mi">7</span><span class="p">,</span><span class="mi">11</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># Should be (0,0), in musical logic.</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[37]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>(8, 12)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [38]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># This result is meaningless.</span>
<span class="n">chroma</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>  <span class="c1"># KeyError</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-38-114c113c80ec&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-fg"># This result is meaningless.</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>chroma<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">8</span><span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">12</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/Users/adamwood/amwenv/lib/python3.5/functools.py</span> in <span class="ansi-cyan-fg">wrapper</span><span class="ansi-blue-fg">(*args, **kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    741</span> 
<span class="ansi-green-intense-fg ansi-bold">    742</span>     <span class="ansi-green-fg">def</span> wrapper<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kw<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 743</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> dispatch<span class="ansi-blue-fg">(</span>args<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>__class__<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kw<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    744</span> 
<span class="ansi-green-intense-fg ansi-bold">    745</span>     registry<span class="ansi-blue-fg">[</span>object<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> func

<span class="ansi-green-fg">&lt;ipython-input-28-f2a6c2b4cc47&gt;</span> in <span class="ansi-cyan-fg">_</span><span class="ansi-blue-fg">(xy)</span>
<span class="ansi-green-intense-fg ansi-bold">     13</span> <span class="ansi-green-fg">def</span> _<span class="ansi-blue-fg">(</span>xy<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     14</span>     x<span class="ansi-blue-fg">,</span>y <span class="ansi-blue-fg">=</span> xy
<span class="ansi-green-fg">---&gt; 15</span><span class="ansi-red-fg">     </span>name <span class="ansi-blue-fg">=</span> name_map<span class="ansi-blue-fg">[</span>x<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">     16</span>     modifier <span class="ansi-blue-fg">=</span> modifiers<span class="ansi-blue-fg">[</span>y <span class="ansi-blue-fg">-</span> hs_map<span class="ansi-blue-fg">[</span>x<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">     17</span>     <span class="ansi-green-fg">return</span> <span class="ansi-blue-fg">" "</span><span class="ansi-blue-fg">.</span>join<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span>name<span class="ansi-blue-fg">,</span> modifier<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/Users/adamwood/amwenv/lib/python3.5/site-packages/bidict/_common.py</span> in <span class="ansi-cyan-fg">proxy</span><span class="ansi-blue-fg">(self, *args)</span>
<span class="ansi-green-intense-fg ansi-bold">     94</span>         attr <span class="ansi-blue-fg">=</span> getattr<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> attrname<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     95</span>         meth <span class="ansi-blue-fg">=</span> getattr<span class="ansi-blue-fg">(</span>attr<span class="ansi-blue-fg">,</span> methodname<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 96</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> meth<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     97</span>     proxy<span class="ansi-blue-fg">.</span>__name__ <span class="ansi-blue-fg">=</span> methodname
<span class="ansi-green-intense-fg ansi-bold">     98</span>     proxy<span class="ansi-blue-fg">.</span>__doc__ <span class="ansi-blue-fg">=</span> doc <span class="ansi-green-fg">or</span> <span class="ansi-blue-fg">"Like dict's ``%s``."</span> <span class="ansi-blue-fg">%</span> methodname

<span class="ansi-red-fg">KeyError</span>: 8</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Additionally, I need to include octave designations. The arithmetic is almost included for free with the functional approach, but the translation functions don't support it.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [39]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Maj Second (or D) and min 3, with a third term for octave designation</span>
<span class="n">augment</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> 
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[39]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>(3, 5, 3)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [40]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># F, 2 octaves above Middle C</span>
<span class="n">chroma</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="c1"># ValueError</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-40-3c4313b92e77&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>chroma<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">5</span><span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span> <span class="ansi-red-fg"># F, 2 octaves above Middle C</span>

<span class="ansi-green-fg">/Users/adamwood/amwenv/lib/python3.5/functools.py</span> in <span class="ansi-cyan-fg">wrapper</span><span class="ansi-blue-fg">(*args, **kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    741</span> 
<span class="ansi-green-intense-fg ansi-bold">    742</span>     <span class="ansi-green-fg">def</span> wrapper<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kw<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 743</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> dispatch<span class="ansi-blue-fg">(</span>args<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>__class__<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kw<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    744</span> 
<span class="ansi-green-intense-fg ansi-bold">    745</span>     registry<span class="ansi-blue-fg">[</span>object<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> func

<span class="ansi-green-fg">&lt;ipython-input-28-f2a6c2b4cc47&gt;</span> in <span class="ansi-cyan-fg">_</span><span class="ansi-blue-fg">(xy)</span>
<span class="ansi-green-intense-fg ansi-bold">     12</span> <span class="ansi-blue-fg">@</span>chroma<span class="ansi-blue-fg">.</span>register<span class="ansi-blue-fg">(</span>tuple<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     13</span> <span class="ansi-green-fg">def</span> _<span class="ansi-blue-fg">(</span>xy<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 14</span><span class="ansi-red-fg">     </span>x<span class="ansi-blue-fg">,</span>y <span class="ansi-blue-fg">=</span> xy
<span class="ansi-green-intense-fg ansi-bold">     15</span>     name <span class="ansi-blue-fg">=</span> name_map<span class="ansi-blue-fg">[</span>x<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">     16</span>     modifier <span class="ansi-blue-fg">=</span> modifiers<span class="ansi-blue-fg">[</span>y <span class="ansi-blue-fg">-</span> hs_map<span class="ansi-blue-fg">[</span>x<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span>

<span class="ansi-red-fg">ValueError</span>: too many values to unpack (expected 2)</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The translation functions and associated dictionaries need to be extended to include multiple representations such as Unicode, ASCII, and <a href="http://lilypond.org/text-input.html">Lilypond</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally, I might also do some experiementation with a hybrid approach that would keep the OO API intact. However, that might get too complicated.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Is-Functional-Really-Better?">Is Functional Really Better?<a class="anchor-link" href="#Is-Functional-Really-Better?">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I don't know.</p>
<p>The difference in execution speed can probably be resolved by cleaning up the OO implememenation and importing the tuple-based arithmetic instead of the union-of-sets approach. I suspect that this would also make the OO code easier to read and reason about.</p>
<p>I'm not at all convinced that there is <a href="http://harmful.cat-v.org/software/OO_programming/">something inherently wrong with object oriented code</a>. However, I do think that a classical paradigm promotes a "different things are different things" mentality. In some cases this is probably helpful. In music, at least in this case, it obscured a fundamental sameness between two important concepts. Functional programming forced me to recognize that sameness. Someone else might have recognized it anyway, and written a good OO implementation first.</p>
<p>If there is a generalizable lesson here, I think it might this: Think through a few different approaches and paradigms. Try coding up more than one logical implementation in the domain. See how that sheds light on the underlying problems and data structure.</p>
<p>Also, don't be afraid to redesign things. Especially if you don't have any users yet.</p>

</div>
</div>
</div>
    </div>
  </div>

    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../emacs-for-technical-writing/" rel="prev" title="Emacs for Technical Writing">Previous post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="adammichaelwood",
            disqus_url="http://hackwrite.com/posts/object-oriented-vs-functional-modelling-of-musical-arithmetic-in-python/",
        disqus_title="Object-oriented vs. Functional Modelling of Musical Arithmetic in Python",
        disqus_identifier="cache/posts/ophis-f-v-oo.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-SDRP1VVYu+tgAGKhddBSl5+ezofHKZeI+OzxakbIe/Y=" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
        </script></article><script>var disqus_shortname="adammichaelwood";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script></main><footer id="footer"><p>© 2016–2017 <a href="mailto:adam.michael.wood@gmail.com">Adam Michael Wood</a> - <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> <br><span id="powered-by">Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a></span></p>
            
        </footer>
</div>
    
    

        <script src="../../assets/js/baguetteBox.min.js"></script><script>baguetteBox.run('a.reference', {
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-46189469-6', 'auto'); ga('send', 'pageview');</script>
</body>
</html>
